(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{180:function(e,o,t){"use strict";(function(e){t(5);r(t(3));var o=r(t(181));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(o.default)}).call(this,t(1)["createPage"])},181:function(e,o,t){"use strict";t.r(o);var r=t(182),n=t(184);for(var i in n)"default"!==i&&function(e){t.d(o,e,(function(){return n[e]}))}(i);t(186);var a,s=t(11),d=Object(s["default"])(n["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],a);d.options.__file="pages/search/search.vue",o["default"]=d.exports},182:function(e,o,t){"use strict";t.r(o);var r=t(183);t.d(o,"render",(function(){return r["render"]})),t.d(o,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(o,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(o,"components",(function(){return r["components"]}))},183:function(e,o,t){"use strict";var r;t.r(o),t.d(o,"render",(function(){return n})),t.d(o,"staticRenderFns",(function(){return a})),t.d(o,"recyclableRender",(function(){return i})),t.d(o,"components",(function(){return r}));try{r={uniPopup:function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,233))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var n=function(){var e=this,o=e.$createElement,t=(e._self._c,e.getImage("icos/camera.png")),r=e.getImage("icos/record.png"),n=e.oldKeywordList.length>0?e.getImage("HM-search/delete.png"):null,i=e.getImage("HM-search/attention"+e.forbid+".png"),a=""==e.forbid?e.__map(e.hotKeywordList,(function(o,t){var r=e.__get_orig(o),n=t<3?e.getImage("icos/hot.png"):null;return{$orig:r,m4:n}})):null,s=e.__map(e.imageResults,(function(o,t){var r=e.__get_orig(o),n=Math.floor(100*o.score);return{$orig:r,g0:n}}));e.$mp.data=Object.assign({},{$root:{m0:t,m1:r,m2:n,m3:i,l0:a,l1:s}})},i=!1,a=[];n._withStripped=!0},184:function(e,o,t){"use strict";t.r(o);var r=t(185),n=t.n(r);for(var i in r)"default"!==i&&function(e){t.d(o,e,(function(){return r[e]}))}(i);o["default"]=n.a},185:function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=function(){t.e("components/uni-popup/uni-popup").then(function(){return resolve(t(233))}.bind(null,t)).catch(t.oe)},n=function(){t.e("components/myPopup").then(function(){return resolve(t(268))}.bind(null,t)).catch(t.oe)},i=function(){t.e("components/share").then(function(){return resolve(t(247))}.bind(null,t)).catch(t.oe)},a=e.getRecorderManager(),s=e.createInnerAudioContext();s.autoplay=!0;var d={components:{uniPopup:r,myPopup:n,share:i},data:function(){return{defaultKeyword:"",keyword:"",oldKeywordList:[],hotKeywordList:[],keywordList:[],forbid:"",isShowKeywordList:!1,imagePath:"",popupShow:!1,voicePath:"",startTiming:!1,drawTiming:!1,timeoutTiming:!1,animaTiming1:!1,animaTiming2:!1,animationData:{},maxTime:5e3,frame:50,possible:[],reference:null,results:[],imageResults:[{score:.944264,root:"商品-箱包",keyword:"手提袋"},{score:.799999,root:"Logo",keyword:"85度c"},{score:.589144,root:"商品-箱包",keyword:"购物袋"},{score:.227161,root:"商品-箱包",keyword:"塑料购物袋"},{score:.018175,root:"商品-箱包",keyword:"宣传袋"}],imagesResultShow:!1,replyWord:["很抱歉,识别精灵未能匹配到,将会尽快完善 ᕙ(⇀‸↼‵‵)ᕗ","未能匹配到结果,识别精灵会继续学习的, 试试其他的吧(๑°⌓°๑)","识别精灵成长中，正在学习该垃圾的分类","抱歉，识别精灵未能给您提供合适的结果","请尝试换一个搜索关键词试试看吧","很抱歉,识别精灵未能匹配到,将会尽快完善 ᕙ(⇀‸↼‵‵)ᕗ"],detailPopupShow:!1,detailShowObject:null}},onLoad:function(o){var t=this;if(1==o.type)t.takePhoto();else if(2==o.type)t.readyRecord();else if(3==o.type&&(console.log(" search-------"),console.log(o),o.keyword)){if(t.keyword=o.keyword,"null"!=o.uni){var r=JSON.parse(o.uni);t.detailPopupShow=!0,t.detailShowObject={keyword:r.garbageName,garbageType:r.garbageType,remark:r.remark},t.saveKeyword(r.garbageName)}if(console.log(o.keywordList),console.log("[]"==o.keywordList),"[]"!=o.keywordList){JSON.parse(o.keywordList);t.isShowKeywordList=!0,t.keywordList=t.drawCorrelativeKeyword(JSON.parse(o.keywordList),t.keyword)}console.log(t.isShowKeywordList),console.log(t.keywordList),console.log(t.detailPopupShow),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()}t.init(),console.log(1),a.onStop((function(o){e.showLoading({title:"正在努力识别中..."}),console.log("recorder stop"+JSON.stringify(o)),t.voicePath=o.tempFilePath,console.log(t.voicePath),t.popupShow=!1,e.uploadFile({url:t.serverUrl+"/upload/record",filePath:t.voicePath,name:"file",success:function(e){console.log(e.data);var o=JSON.parse(e.data),r=o.data,n=r.uni;t.keyword=r.keyword,t.isShowKeywordList=!0,t.keywordList=t.drawCorrelativeKeyword(r.results,t.keyword),n&&(t.detailPopupShow=!0,t.detailShowObject={keyword:n.garbageName,garbageType:n.garbageType,remark:n.remark}),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()},complete:function(){e.hideLoading()}})}))},methods:{getImage:function(e){return this.imageUrl+e},tapKeyword:function(e){this.keyword=e,this.doSearch(),this.imagesResultShow=!1},noTitlemodalTap:function(){e.showModal({title:"未能匹配成功",content:this.replyWord[Math.round(5*Math.random())],confirmText:"知道了",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})},showDetail:function(e){this.detailShowObject=e,this.detailPopupShow=!0},hideMypopup:function(){this.detailPopupShow=!1},hideUnipPpup:function(){this.imagesResultShow=!1},readyRecord:function(){this.popupShow=!0},start:function(){this.recording()},end:function(){a.stop(),clearInterval(this.draw),clearTimeout(this.startTiming),clearTimeout(this.timeoutTiming),clearInterval(this.animaTiming1),clearInterval(this.animaTiming2),this.draw=!1,this.startTiming=!1,this.timeoutTiming=!1,this.animaTiming1=!1,this.animaTiming2=!1;var o=e.createAnimation({duration:500,timingFunction:"ease"});this.animation=o,o.scale(1,1).step(),this.animationData=o.export()},recording:function(){var o=this;a.start(),o.animaTiming1=setInterval((function(){var t=e.createAnimation({duration:500,timingFunction:"ease"});o.animation=t,t.scale(1.3,1.3).step(),o.animationData=t.export()}),500),o.animaTiming2=setInterval((function(){var t=e.createAnimation({duration:500,timingFunction:"ease"});o.animation=t,t.scale(1,1).step(),o.animationData=t.export()}),1e3),o.timeoutTiming=setTimeout((function(){clearInterval(o.draw),o.draw=!1,o.animaTiming1=!1,o.animaTiming2=!1,a.stop()}),o.maxTime)},playVoice:function(){var e=this;e.voicePath&&(s.src=e.voicePath,s.play())},hidePopup:function(){this.popupShow=!1},takePhoto:function(){var o=this;e.chooseImage({count:1,success:function(t){e.showLoading({title:"正在努力识别中..."}),o.imagePath=t.tempFilePaths[0],console.log(o.imagePath),e.uploadFile({url:o.serverUrl+"/upload/image",filePath:t.tempFilePaths[0],name:"file",success:function(e){console.log(e.data);var t=JSON.parse(e.data),r=t.data,n=JSON.parse(r.response);console.log(n.result);var i=r.uni;o.keyword=r.keyword,o.keywordList=o.drawCorrelativeKeyword(r.results,o.keyword),i?(o.isShowKeywordList=!0,o.detailPopupShow=!0,o.detailShowObject={keyword:i.garbageName,garbageType:i.garbageType,remark:i.remark}):o.keywordList.length>0?o.isShowKeywordList=!0:(o.imageResults=n.result,o.imagesResultShow=!0)},complete:function(){e.hideLoading()}})}})},init:function(){this.loadDefaultKeyword(),this.loadOldKeyword(),this.loadHotKeyword()},blur:function(){e.hideKeyboard()},loadDefaultKeyword:function(){this.defaultKeyword="苹果"},loadOldKeyword:function(){var o=this;e.getStorage({key:"OldKeys",success:function(e){var t=JSON.parse(e.data);o.oldKeywordList=t}})},loadHotKeyword:function(){var o=this;o.hotKeywordList=["键盘","鼠标","显示器","电脑主机","蓝牙音箱","笔记本电脑","鼠标垫","USB","USB3.0"],e.request({url:o.serverUrl+"/qb/top10",success:function(e){o.hotKeywordList=e.data.data.map((function(e){return e.keyword}))}})},inputChange:function(){var o=this,t=this.keyword;console.log("keyword:"+t),setTimeout((function(){if(console.log("results:"+t),!t)return o.keywordList=[],void(o.isShowKeywordList=!1);o.isShowKeywordList=!0,e.request({url:o.serverUrl+"/qb/name/"+t,success:function(e){console.log(e),o.keywordList=o.drawCorrelativeKeyword(e.data.data,t)}})}),300)},drawCorrelativeKeyword:function(e,o){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n],a=i.garbageName.replace(o,"<span style='color: #72c69c;'>"+o+"</span>");a="<div>"+a+"</div>";var s={keyword:i.garbageName,htmlStr:a,garbageType:i.garbageType,remark:i.remark};r.push(s)}return r},setkeyword:function(e){this.keyword=e.keyword},oldDelete:function(){var o=this;e.showModal({content:"确定清除历史搜索记录？",success:function(t){t.confirm?(console.log("用户点击确定"),o.oldKeywordList=[],e.removeStorage({key:"OldKeys"})):t.cancel&&console.log("用户点击取消")}})},hotToggle:function(){this.forbid=this.forbid?"":"_forbid"},doSearch:function(o){var t=this;e.showLoading({title:"正在努力查询中..."}),o=o||(this.keyword?this.keyword:this.defaultKeyword),this.keyword=o,this.saveKeyword(o),e.request({url:this.serverUrl+"/qb/uniname/"+this.keyword,success:function(e){console.log(e);var o=e.data.data,r=o.uni,n=o.results;r&&(t.detailPopupShow=!0,t.detailShowObject={keyword:r.garbageName,garbageType:r.garbageType,remark:r.remark}),n.length>0&&(t.keywordList=t.drawCorrelativeKeyword(n,t.keyword)),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()},complete:function(){e.hideLoading()}})},saveKeyword:function(o){var t=this;e.getStorage({key:"OldKeys",success:function(r){console.log(r.data);var n=JSON.parse(r.data),i=n.indexOf(o);-1==i||n.splice(i,1),n.unshift(o),n.length>10&&n.pop(),e.setStorage({key:"OldKeys",data:JSON.stringify(n)}),t.oldKeywordList=n},fail:function(r){var n=[o];e.setStorage({key:"OldKeys",data:JSON.stringify(n)}),t.oldKeywordList=n}})}}};o.default=d}).call(this,t(1)["default"])},186:function(e,o,t){"use strict";t.r(o);var r=t(187),n=t.n(r);for(var i in r)"default"!==i&&function(e){t.d(o,e,(function(){return r[e]}))}(i);o["default"]=n.a},187:function(e,o,t){}},[[180,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/search/search.js.map